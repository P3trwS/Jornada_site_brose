<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funcionários</title>
    {% load static %}
    <link id="css" rel="stylesheet" href="{% static 'Funcionarios/Light Mode/light.css' %}">
</head>

<body>
<header>
    <nav>
        <a href="{% url 'funcionario' %}">
            <img src="{% static 'Cursos/Brose_logo.png' %}" alt="Brose Logo" class="logo">
        </a>
    </nav>

    <div class="pages">
        <a id="Cursos-sideBar" href="{% url 'cursos' %}">Cursos</a>
        <a id="Cargos-sideBar" href="{% url 'cargos' %}">Cargos</a>
        <a id="Perfil-sideBar" href="{% url 'funcionario' %}">Funcionários</a>
    </div>

    <nav>
        <label>PT</label>
        <label>EN</label>
        <label>GR</label>
        <button id="botão-dark" onclick="darkMode()" class="dark-mode">Alterar Tema</button>
    </nav>
</header>

<main>
    <div class="tela-tabela">
        <h1>Funcionários</h1>
        <button onclick="abrirModal()" class="novoFuncionario">Novo Funcionário</button>

        <div class="rolagem">
            <table class="tabela" id="tabelaFuncionarios">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Cargo</th>
                        <th>Skill</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for funcionario in funcionarios %}
                    <tr>
                        <td>{{ funcionario.nome }}</td>
                        <td>{{ funcionario.cargo }}</td>
                        <td>
                            {% for skill in funcionario.skills.all %}
                                {{ skill.nome }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td>
                            <a href="javascript:void(0);" onclick="abrirModalEdicao('{{ funcionario.id }}', '{{ funcionario.nome }}', '{{ funcionario.cargo }}', '{{ funcionario.skills.all|join:", " }}')">Editar</a> |
                            <form action="{% url 'deletar_funcionario' funcionario.id %}" method="POST" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" onclick="return confirm('Tem certeza que deseja excluir?')">Deletar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- Modal para criar um novo funcionário -->
<div id="modalNovoFuncionario" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <h2>Criar Novo Funcionário</h2>

        <form method="POST" action="{% url 'criar_funcionario' %}">
            {% csrf_token %}
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>

            <label for="cargo">Cargo:</label>
            <select id="cargo" name="cargo" required>
                {% for cargo in cargos %}
                    <option value="{{ cargo.id }}">{{ cargo.nome }}</option>
                {% endfor %}
            </select>
            
            <label>Skills Existentes:</label>
            <ul>
                {% for skill in skills %}
                    <li>
                        <input type="checkbox" id="skill_{{ skill.id }}" name="skills_existentes" value="{{ skill.id }}">
                        <label for="skill_{{ skill.id }}">{{ skill.nome }}</label>
                    </li>
                {% endfor %}
            </ul>
            
            <label for="nova_skill">Adicionar Nova Skill:</label>
            <input type="text" id="nova_skill" name="nova_skill" placeholder="Nova habilidade">

            <button type="submit">Salvar</button>
        </form>
    </div>
</div>

<!-- Modal para editar um funcionário -->
<div id="modalEditarFuncionario" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="fecharModalEdicao()">&times;</span>
        <h2>Editar Funcionário</h2>

        <form method="POST" id="formEditarFuncionario">
            {% csrf_token %}
            <label for="nomeEditar">Nome:</label>
            <input type="text" id="nomeEditar" name="nome" required>

            <label for="cargoEditar">Cargo:</label>
            <select id="cargoEditar" name="cargo" required>
                {% for cargo in cargos %}
                    <option value="{{ cargo.id }}">{{ cargo.nome }}</option>
                {% endfor %}
            </select>
            
            <label>Skills Existentes:</label>
            <ul>
                {% for skill in skills %}
                    <li>
                        <input type="checkbox" id="skillEditar_{{ skill.id }}" name="skills_existentes" value="{{ skill.id }}">
                        <label for="skillEditar_{{ skill.id }}">{{ skill.nome }}</label>
                    </li>
                {% endfor %}
            </ul>
            
            <label for="nova_skillEditar">Adicionar Nova Skill:</label>
            <input type="text" id="nova_skillEditar" name="nova_skill" placeholder="Nova habilidade">

            <button type="submit">Salvar Alterações</button>
        </form>
    </div>
</div>

<script src="{% static 'Funcionarios/script.js' %}"></script>
</body>
</html>
